syntax = "proto3";

package pb;

option go_package = "github.com/taurusgroup/cmp-ecdsa/pb";

import "types.proto";
import "zk.proto";

enum MessageType {
  TypeInvalid = 0;

  TypeKeygen1 = 11;
  TypeKeygen2 = 12;
  TypeKeygen3 = 13;

  TypeRefresh1 = 21;
  TypeRefresh2 = 22;
  TypeRefresh3 = 23;

  TypeSign1 = 31;
  TypeSign2 = 32;
  TypeSign3 = 33;
  TypeSign4 = 34;

  TypeAbort1 = 41;
  TypeAbort2 = 42;
}

enum Broadcast {
  None = 0;
  Basic = 1;
  Reliable = 2;
}

message Message {
  MessageType type = 1;
  string from = 2;
  string to = 3;
  Broadcast broadcast = 4;

  Keygen1 keygen1 = 11;
  Keygen2 keygen2 = 12;
  Keygen3 keygen3 = 13;

  Refresh1 refresh1 = 21;
  Refresh2 refresh2 = 22;
  Refresh3 refresh3 = 23;

  Sign1 sign1 = 31;
  Sign2 sign2 = 32;
  Sign3 sign3 = 33;
  Sign4 sign4 = 34;

  Abort1 abort1 = 41;
  Abort2 abort2 = 42;
}


message Keygen1 {
  bytes hash = 1;
}

message Keygen2 {
  bytes rid = 1;
  Point X = 2;
  Point A = 3;
  bytes u = 4;

  bytes prevHash = 10;
}

message Keygen3 {
  Scalar schX = 1;
}

message Refresh1 {
  bytes hash = 1;
}

message Refresh2 {
  repeated Point X = 1;
  repeated Point A = 2;
  Point Y = 3;
  Point B = 4;
  Int N = 5;
  Int S = 6;
  Int T = 7;
  bytes rho = 8;
  bytes u = 9;

  bytes prevHash = 10;
}

message Refresh3 {
  ZKMod mod = 1;
  ZKPrm prm = 2;
  Ciphertext c = 3;
  repeated Scalar schX = 4;
  Scalar schY = 5;
}

message Sign1 {
  ZKEnc enc = 1;
  Ciphertext K = 2;
  Ciphertext G = 3;
}

message Sign2 {
  Point Gamma = 1;
  Ciphertext D = 2;
  Ciphertext F = 3;
  Ciphertext DHat = 4;
  Ciphertext FHat = 5;
  ZKAffG ProofAffG = 6;
  ZKAffG ProofAffGHat = 7;
  ZKLogStar ProofLog = 8;
}

message Sign3 {
  Scalar Delta = 1;
  Point DeltaGroup = 2;
  ZKLogStar ProofLog = 3;
}

message Sign4 {
  Scalar Sigma = 1;
}

message Abort1 {
  map <string, ZKAffG> proofAffg = 1;
  ZKMul proofMul = 2;
  map <string, ZKDec> proofDec = 3;
}

message Abort2 {
  map <string, ZKAffG> proofAffg = 1;
  map <string, ZKMulStar> proofMul = 2;
  map <string, ZKDec> proofDec = 3;
}